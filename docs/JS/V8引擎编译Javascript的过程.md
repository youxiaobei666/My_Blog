# V8 引擎编译 Javascript 的过程

:::tip
众所周知：计算机、浏览器只能识别二进制机器语言，就是 010101 这样的机器语言。为了让我们编写的 JavaScript 的代码能被浏览器识别运行，我们需要一个引擎完成这个过程。
:::

## 1.编程语言的分类：

1. 解释型语言和编译型语言：

像我们的 JavaScript 和 Python 就是解释型语言，Java 和 C 语言就是编译型语言。

|            | 举例               | 特点                                                                                  | 编译过程                               |
| ---------- | ------------------ | ------------------------------------------------------------------------------------- | -------------------------------------- |
| 解释型语言 | JavaScript、Python | 编译速度快，但每次执行都会重新编译源文件，并且逐行执行效率低                          | 通过解释器翻译成可跨平台运行的中间代码 |
| 编译型语言 | C 语言、Java、C++  | 只需要编译一次就可以多次执行，不需要源代码，运行起来很快，但是跨平台性差（java 除外） | 先预处理之后编译，再汇编成二进制文件   |

2. 面向对象和面向过程

## 2. 了解 v8 引擎的历史和性能提升

:::tip
在第二次浏览器大战之前，我们的 JavaScript 引擎只能简单的执行 Javascript 源代码。

第一个 JavaScript 引擎由网景公司开发，用于网页浏览器中。后来 Google 开发了我们的

v8 引擎，v8 引擎让谷歌在这场浏览器大战中取胜。
:::

## 3. v8 引擎编译 JavaScript 的过程

图示：

![img01](/images/JS/V801.png)

### 1. parsing(解析)和词法分析:

1. 解析器(parser)

首先我们的解析器(parser)，会把脚本(scripts)，解析成一种语法树，为了方便解释器读取。

抽象语法树是什么:

:::tip
抽象语法树(Abstract Syntax Tree):

在计算机科学中，抽象语法树（Abstract Syntax Tree，AST），或简称语法树（Syntax tree），是源代码语法结构的一种抽象表示。它以树状的形式表现编程语言的语法结构，树上的每个节点都表示源代码中的一种结构。之所以说语法是“抽象”的，是因为这里的语法并不会表示出真实语法中出现的每个细节。比如，嵌套括号被隐含在树的结构中，并没有以节点的形式呈现；而类似于 if-condition-then 这样的条件跳转语句，可以使用带有三个分支的节点来表示。

和抽象语法树相对的是具体语法树（通常称作分析树）。一般的，在源代码的翻译和编译过程中，语法分析器创建出分析树，然后从分析树生成 AST。一旦 AST 被创建出来，在后续的处理过程中，比如语义分析阶段，会添加一些信息。
:::

### 2.词法分析器（lexical analyzer，简称 lexer）

词法分析器也叫扫描器（scanner）会把我们的代码里的各个部分拆分做上记号(Token)

举个例子：

```js
sum = 1 + 2;
age = 18;
```

针对以上代码: 我们的词法分析器会把它分解做上标记 ​​​​​：

| 语素：各个部分 | 记号类型   |
| -------------- | ---------- |
| sum            | 标识符     |
| =              | 赋值操作符 |
| 1              | 数字       |
| +              | 加法操作符 |
| 2              | 数字       |
| ；             | 结束符号   |
| age            | 标识符     |

### 2. (解释器) 将语法树解释(interpret)为字节码

:::tip
解释器（英语：interpreter），是一种 计算机程序，能够把解释型语言解释执行。解释器就像一位“中间人”。解释器边解释边执行，因此依赖于解释器的程序运行速度比较缓慢。解释器的好处是它不需要重新编译整个程序，从而减轻了每次程序更新后编译的负担。相对的编译器一次性将所有源代码编译成二进制文件，执行时无需依赖编译器或其他额外的程序。
:::

解释器会把语法树解释为字节码：介于解释与编译之间的一种代码，并不属于机器代码，可以跨平台运行。

:::tip
字节码：考量程序执行之前所需要分析的时间，存在了一个介于解释与编译之间的可能性。例如，用 Emacs Lisp 所撰写的源代码会被编译成一种高度压缩且优化的另一种 Lisp 源代码格式，这就是一种字节码（bytecode），而它并不是机器代码（因此不会被绑死在特定的硬件上）。 维基百科。
:::
